{"ast":null,"code":"import { shakebook } from '@/service/api/v1/account_pb';\nimport * as types from './types';\nimport axios from 'axios';\nimport camelcaseKeys from 'camelcase-keys';\nimport api from '@/api';\nimport { notification } from 'antd';\n\nconst getAccountAction = res => {\n  return {\n    type: types.GET_ACCOUNT,\n    account: { ...res\n    }\n  };\n};\n\nexport function getAccountRequest(req) {\n  return dispatch => {\n    axios({\n      method: 'get',\n      url: api.getAccount,\n      data: req.data,\n      headers: {\n        \"Grpc-metadata-token\": \"BEARER \" + localStorage.getItem(\"token\")\n      }\n    }).then(function (res) {\n      var _ret$response;\n\n      let ret = shakebook.GetAccountResponse.fromObject(camelcaseKeys(res.data, {\n        deep: true\n      }));\n\n      if (res.status === 200 && ((_ret$response = ret.response) === null || _ret$response === void 0 ? void 0 : _ret$response.success)) {\n        dispatch(getAccountAction(ret.data));\n      } else {\n        var _ret$response2;\n\n        notification['warning']({\n          message: '信息提示',\n          description: (_ret$response2 = ret.response) === null || _ret$response2 === void 0 ? void 0 : _ret$response2.message\n        });\n        localStorage.removeItem(\"token\");\n        req.history.push('/login');\n      }\n    }).catch(function (error) {\n      notification['error']({\n        message: '信息提示',\n        description: \"请稍后重试\"\n      });\n      localStorage.removeItem(\"token\");\n      req.history.push('/login');\n    });\n  };\n} //退出登录\n\nexport function signoutRequest(req) {\n  return dispatch => {\n    axios({\n      method: 'post',\n      url: api.signout,\n      headers: {\n        \"Grpc-metadata-token\": \"BEARER \" + localStorage.getItem(\"token\")\n      }\n    }).then(function (res) {\n      var _ret$response3;\n\n      let ret = shakebook.GetAccountResponse.fromObject(camelcaseKeys(res.data, {\n        deep: true\n      }));\n\n      if (res.status === 200 && ((_ret$response3 = ret.response) === null || _ret$response3 === void 0 ? void 0 : _ret$response3.success)) {\n        dispatch(getAccountAction(ret.data));\n      } else {\n        var _ret$response4;\n\n        notification['warning']({\n          message: '信息提示',\n          description: (_ret$response4 = ret.response) === null || _ret$response4 === void 0 ? void 0 : _ret$response4.message\n        });\n        localStorage.removeItem(\"token\");\n        req.history.push('/login');\n      }\n    }).catch(function (error) {\n      notification['error']({\n        message: '信息提示',\n        description: \"请稍后重试\"\n      });\n      localStorage.removeItem(\"token\");\n      req.history.push('/login');\n    });\n  };\n}","map":{"version":3,"sources":["/Users/yangjiafeng/web-src/shake-book-manager/src/pages/home/header/store/actions.ts"],"names":["shakebook","types","axios","camelcaseKeys","api","notification","getAccountAction","res","type","GET_ACCOUNT","account","getAccountRequest","req","dispatch","method","url","getAccount","data","headers","localStorage","getItem","then","ret","GetAccountResponse","fromObject","deep","status","response","success","message","description","removeItem","history","push","catch","error","signoutRequest","signout"],"mappings":"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","sourcesContent":["import { shakebook } from '@/service/api/v1/account_pb'\nimport * as types from './types'\nimport axios from 'axios';\nimport camelcaseKeys from 'camelcase-keys'\nimport api from '@/api';\nimport { notification } from 'antd';\n\nconst getAccountAction = (res: shakebook.IAccountInfo): types.GetAccountAction => {\n  return {\n    type: types.GET_ACCOUNT,\n    account: { ...res }\n  }\n}\n\nexport function getAccountRequest(req: types.GetAccountRequestWithProps) {\n  return (dispatch: types.GetAccountDispatch) => {\n    axios({\n      method: 'get',\n      url: api.getAccount,\n      data: req.data,\n      headers: {\n        \"Grpc-metadata-token\": \"BEARER \" + localStorage.getItem(\"token\")\n      }\n    }).then(function (res) {\n      let ret: shakebook.IGetAccountResponse =\n        shakebook.GetAccountResponse.fromObject(\n          camelcaseKeys(res.data as Object, {\n            deep: true\n          }),\n        )\n\n      if (res.status === 200 && ret.response?.success) {\n        dispatch(getAccountAction(ret.data!))\n      } else {\n        notification['warning']({\n          message: '信息提示',\n          description: ret.response?.message\n        });\n        localStorage.removeItem(\"token\")\n        req.history.push('/login')\n\n      }\n    })\n      .catch(function (error) {\n        notification['error']({\n          message: '信息提示',\n          description: \"请稍后重试\"\n        });\n        localStorage.removeItem(\"token\")\n        req.history.push('/login')\n      });\n  }\n}\n\n//退出登录\nexport function signoutRequest(req: types.SignoutRequestWithProps) {\n  return (dispatch: types.GetAccountDispatch) => {\n    axios({\n      method: 'post',\n      url: api.signout,\n      headers: {\n        \"Grpc-metadata-token\": \"BEARER \" + localStorage.getItem(\"token\")\n      }\n    }).then(function (res) {\n      let ret: shakebook.IGetAccountResponse =\n        shakebook.GetAccountResponse.fromObject(\n          camelcaseKeys(res.data as Object, {\n            deep: true\n          }),\n        )\n\n      if (res.status === 200 && ret.response?.success) {\n        dispatch(getAccountAction(ret.data!))\n      } else {\n        notification['warning']({\n          message: '信息提示',\n          description: ret.response?.message\n        });\n        localStorage.removeItem(\"token\")\n        req.history.push('/login')\n\n      }\n    })\n      .catch(function (error) {\n        notification['error']({\n          message: '信息提示',\n          description: \"请稍后重试\"\n        });\n        localStorage.removeItem(\"token\")\n        req.history.push('/login')\n      });\n  }\n}"]},"metadata":{},"sourceType":"module"}