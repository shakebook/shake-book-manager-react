{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.circularDependencyToException = exports.listMetadataForTarget = exports.listRegisteredBindingsForServiceIdentifier = exports.getServiceIdentifierAsString = exports.getFunctionName = void 0;\n\nvar ERROR_MSGS = require(\"../constants/error_msgs\");\n\nfunction getServiceIdentifierAsString(serviceIdentifier) {\n  if (typeof serviceIdentifier === \"function\") {\n    var _serviceIdentifier = serviceIdentifier;\n    return _serviceIdentifier.name;\n  } else if (typeof serviceIdentifier === \"symbol\") {\n    return serviceIdentifier.toString();\n  } else {\n    var _serviceIdentifier = serviceIdentifier;\n    return _serviceIdentifier;\n  }\n}\n\nexports.getServiceIdentifierAsString = getServiceIdentifierAsString;\n\nfunction listRegisteredBindingsForServiceIdentifier(container, serviceIdentifier, getBindings) {\n  var registeredBindingsList = \"\";\n  var registeredBindings = getBindings(container, serviceIdentifier);\n\n  if (registeredBindings.length !== 0) {\n    registeredBindingsList = \"\\nRegistered bindings:\";\n    registeredBindings.forEach(function (binding) {\n      var name = \"Object\";\n\n      if (binding.implementationType !== null) {\n        name = getFunctionName(binding.implementationType);\n      }\n\n      registeredBindingsList = registeredBindingsList + \"\\n \" + name;\n\n      if (binding.constraint.metaData) {\n        registeredBindingsList = registeredBindingsList + \" - \" + binding.constraint.metaData;\n      }\n    });\n  }\n\n  return registeredBindingsList;\n}\n\nexports.listRegisteredBindingsForServiceIdentifier = listRegisteredBindingsForServiceIdentifier;\n\nfunction alreadyDependencyChain(request, serviceIdentifier) {\n  if (request.parentRequest === null) {\n    return false;\n  } else if (request.parentRequest.serviceIdentifier === serviceIdentifier) {\n    return true;\n  } else {\n    return alreadyDependencyChain(request.parentRequest, serviceIdentifier);\n  }\n}\n\nfunction dependencyChainToString(request) {\n  function _createStringArr(req, result) {\n    if (result === void 0) {\n      result = [];\n    }\n\n    var serviceIdentifier = getServiceIdentifierAsString(req.serviceIdentifier);\n    result.push(serviceIdentifier);\n\n    if (req.parentRequest !== null) {\n      return _createStringArr(req.parentRequest, result);\n    }\n\n    return result;\n  }\n\n  var stringArr = _createStringArr(request);\n\n  return stringArr.reverse().join(\" --> \");\n}\n\nfunction circularDependencyToException(request) {\n  request.childRequests.forEach(function (childRequest) {\n    if (alreadyDependencyChain(childRequest, childRequest.serviceIdentifier)) {\n      var services = dependencyChainToString(childRequest);\n      throw new Error(ERROR_MSGS.CIRCULAR_DEPENDENCY + \" \" + services);\n    } else {\n      circularDependencyToException(childRequest);\n    }\n  });\n}\n\nexports.circularDependencyToException = circularDependencyToException;\n\nfunction listMetadataForTarget(serviceIdentifierString, target) {\n  if (target.isTagged() || target.isNamed()) {\n    var m_1 = \"\";\n    var namedTag = target.getNamedTag();\n    var otherTags = target.getCustomTags();\n\n    if (namedTag !== null) {\n      m_1 += namedTag.toString() + \"\\n\";\n    }\n\n    if (otherTags !== null) {\n      otherTags.forEach(function (tag) {\n        m_1 += tag.toString() + \"\\n\";\n      });\n    }\n\n    return \" \" + serviceIdentifierString + \"\\n \" + serviceIdentifierString + \" - \" + m_1;\n  } else {\n    return \" \" + serviceIdentifierString;\n  }\n}\n\nexports.listMetadataForTarget = listMetadataForTarget;\n\nfunction getFunctionName(v) {\n  if (v.name) {\n    return v.name;\n  } else {\n    var name_1 = v.toString();\n    var match = name_1.match(/^function\\s*([^\\s(]+)/);\n    return match ? match[1] : \"Anonymous function: \" + name_1;\n  }\n}\n\nexports.getFunctionName = getFunctionName;","map":{"version":3,"sources":["/Users/yangjiafeng/web-src/shake-book-manager/node_modules/inversify/lib/utils/serialization.js"],"names":["Object","defineProperty","exports","value","circularDependencyToException","listMetadataForTarget","listRegisteredBindingsForServiceIdentifier","getServiceIdentifierAsString","getFunctionName","ERROR_MSGS","require","serviceIdentifier","_serviceIdentifier","name","toString","container","getBindings","registeredBindingsList","registeredBindings","length","forEach","binding","implementationType","constraint","metaData","alreadyDependencyChain","request","parentRequest","dependencyChainToString","_createStringArr","req","result","push","stringArr","reverse","join","childRequests","childRequest","services","Error","CIRCULAR_DEPENDENCY","serviceIdentifierString","target","isTagged","isNamed","m_1","namedTag","getNamedTag","otherTags","getCustomTags","tag","v","name_1","match"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.circularDependencyToException = exports.listMetadataForTarget = exports.listRegisteredBindingsForServiceIdentifier = exports.getServiceIdentifierAsString = exports.getFunctionName = void 0;\nvar ERROR_MSGS = require(\"../constants/error_msgs\");\nfunction getServiceIdentifierAsString(serviceIdentifier) {\n    if (typeof serviceIdentifier === \"function\") {\n        var _serviceIdentifier = serviceIdentifier;\n        return _serviceIdentifier.name;\n    }\n    else if (typeof serviceIdentifier === \"symbol\") {\n        return serviceIdentifier.toString();\n    }\n    else {\n        var _serviceIdentifier = serviceIdentifier;\n        return _serviceIdentifier;\n    }\n}\nexports.getServiceIdentifierAsString = getServiceIdentifierAsString;\nfunction listRegisteredBindingsForServiceIdentifier(container, serviceIdentifier, getBindings) {\n    var registeredBindingsList = \"\";\n    var registeredBindings = getBindings(container, serviceIdentifier);\n    if (registeredBindings.length !== 0) {\n        registeredBindingsList = \"\\nRegistered bindings:\";\n        registeredBindings.forEach(function (binding) {\n            var name = \"Object\";\n            if (binding.implementationType !== null) {\n                name = getFunctionName(binding.implementationType);\n            }\n            registeredBindingsList = registeredBindingsList + \"\\n \" + name;\n            if (binding.constraint.metaData) {\n                registeredBindingsList = registeredBindingsList + \" - \" + binding.constraint.metaData;\n            }\n        });\n    }\n    return registeredBindingsList;\n}\nexports.listRegisteredBindingsForServiceIdentifier = listRegisteredBindingsForServiceIdentifier;\nfunction alreadyDependencyChain(request, serviceIdentifier) {\n    if (request.parentRequest === null) {\n        return false;\n    }\n    else if (request.parentRequest.serviceIdentifier === serviceIdentifier) {\n        return true;\n    }\n    else {\n        return alreadyDependencyChain(request.parentRequest, serviceIdentifier);\n    }\n}\nfunction dependencyChainToString(request) {\n    function _createStringArr(req, result) {\n        if (result === void 0) { result = []; }\n        var serviceIdentifier = getServiceIdentifierAsString(req.serviceIdentifier);\n        result.push(serviceIdentifier);\n        if (req.parentRequest !== null) {\n            return _createStringArr(req.parentRequest, result);\n        }\n        return result;\n    }\n    var stringArr = _createStringArr(request);\n    return stringArr.reverse().join(\" --> \");\n}\nfunction circularDependencyToException(request) {\n    request.childRequests.forEach(function (childRequest) {\n        if (alreadyDependencyChain(childRequest, childRequest.serviceIdentifier)) {\n            var services = dependencyChainToString(childRequest);\n            throw new Error(ERROR_MSGS.CIRCULAR_DEPENDENCY + \" \" + services);\n        }\n        else {\n            circularDependencyToException(childRequest);\n        }\n    });\n}\nexports.circularDependencyToException = circularDependencyToException;\nfunction listMetadataForTarget(serviceIdentifierString, target) {\n    if (target.isTagged() || target.isNamed()) {\n        var m_1 = \"\";\n        var namedTag = target.getNamedTag();\n        var otherTags = target.getCustomTags();\n        if (namedTag !== null) {\n            m_1 += namedTag.toString() + \"\\n\";\n        }\n        if (otherTags !== null) {\n            otherTags.forEach(function (tag) {\n                m_1 += tag.toString() + \"\\n\";\n            });\n        }\n        return \" \" + serviceIdentifierString + \"\\n \" + serviceIdentifierString + \" - \" + m_1;\n    }\n    else {\n        return \" \" + serviceIdentifierString;\n    }\n}\nexports.listMetadataForTarget = listMetadataForTarget;\nfunction getFunctionName(v) {\n    if (v.name) {\n        return v.name;\n    }\n    else {\n        var name_1 = v.toString();\n        var match = name_1.match(/^function\\s*([^\\s(]+)/);\n        return match ? match[1] : \"Anonymous function: \" + name_1;\n    }\n}\nexports.getFunctionName = getFunctionName;\n"]},"metadata":{},"sourceType":"script"}