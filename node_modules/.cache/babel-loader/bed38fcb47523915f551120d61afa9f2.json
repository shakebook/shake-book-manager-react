{"ast":null,"code":"import { manager } from '@/service/api/v1/manager_pb';\nimport * as types from '@/pages/content/pages/menu/store/types';\nimport axios from 'axios';\nimport camelcaseKeys from 'camelcase-keys';\nimport api from '@/requestAPI';\nimport { notification } from 'antd';\n\nconst getMenuListAction = res => {\n  return {\n    type: types.GET_MENU_LIST,\n    data: res\n  };\n};\n\nexport function createMenuRequest(req) {\n  return dispatch => {\n    axios({\n      method: 'post',\n      url: api.managerMenu,\n      data: req,\n      headers: {\n        \"Grpc-metadata-token\": \"BEARER \" + localStorage.getItem(\"token\")\n      }\n    }).then(function (res) {\n      let ret = manager.Response.fromObject(camelcaseKeys(res.data, {\n        deep: true\n      }));\n\n      if (res.status === 200 && ret.success) {\n        notification['success']({\n          message: '信息提示',\n          description: \"新增成功\"\n        });\n      } else {\n        notification['warning']({\n          message: '信息提示',\n          description: ret.message\n        });\n      }\n    }).catch(function (err) {\n      localStorage.removeItem(\"token\");\n      window.globalHistory.push('/login');\n    });\n  };\n}\nexport function getMenuListRequest() {\n  return dispatch => {\n    axios({\n      method: 'get',\n      url: api.managerMenu,\n      headers: {\n        \"Grpc-metadata-token\": \"BEARER \" + localStorage.getItem(\"token\")\n      }\n    }).then(function (res) {\n      let ret = manager.GetMenuListResponse.fromObject(camelcaseKeys(res.data, {\n        deep: true\n      }));\n\n      if (res.status === 200 && ret.success) {\n        toTree(res.data);\n        dispatch(getMenuListAction(ret.data));\n      } else {\n        notification['warning']({\n          message: '信息提示',\n          description: ret.message\n        });\n      }\n    }).catch(function (err) {\n      localStorage.removeItem(\"token\");\n      window.globalHistory.push('/login');\n    });\n  };\n}\n\nfunction toTree(data) {\n  //递归树算法 将pid-id的数据库返回的json 转为树json\n  // 删除 所有 children,以防止多次调用\n  data.forEach(function (item) {\n    item.title = item.menuName;\n    item.value = item.id;\n    item.key = item.id; // delete item.id;\n    // delete item.name;\n    // delete item.children;\n  }); // 将数据存储为 以id为KEY的map索引数据列 \n\n  let map = {};\n  data.forEach(function (item) {\n    map[item.value] = item;\n  }); // console.log(map);\n\n  let val = [];\n  data.forEach(function (item) {\n    // 以当前遍历项，的pid,去map对象中找到索引的id\n    var parent = map[item.pid]; // 好绕啊，如果找到索引，那么说明此项不在顶级当中,那么需要把此项添加到，他对应的父级中\n\n    if (parent) {\n      (parent.children || (parent.children = [])).push(item); //这里更改的是map对象的数据(索引数据)\n      // console.log(map);\n    } else {\n      //如果没有在map中找到对应的索引ID,那么直接把 当前的item添加到 val结果集中，作为顶级\n      val.push(item);\n    }\n  });\n  return val;\n}","map":{"version":3,"sources":["/Users/yangjiafeng/web-src/shake-book-manager/src/pages/content/pages/menu/store/actions.ts"],"names":["manager","types","axios","camelcaseKeys","api","notification","getMenuListAction","res","type","GET_MENU_LIST","data","createMenuRequest","req","dispatch","method","url","managerMenu","headers","localStorage","getItem","then","ret","Response","fromObject","deep","status","success","message","description","catch","err","removeItem","window","globalHistory","push","getMenuListRequest","GetMenuListResponse","toTree","forEach","item","title","menuName","value","id","key","map","val","parent","pid","children"],"mappings":"AAAA,SAASA,OAAT,QAAwB,6BAAxB;AACA,OAAO,KAAKC,KAAZ,MAAuB,wCAAvB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,aAAP,MAA0B,gBAA1B;AACA,OAAOC,GAAP,MAAgB,cAAhB;AACA,SAASC,YAAT,QAA6B,MAA7B;;AAOA,MAAMC,iBAAiB,GAAIC,GAAD,IAAuD;AAC/E,SAAO;AACLC,IAAAA,IAAI,EAAEP,KAAK,CAACQ,aADP;AAELC,IAAAA,IAAI,EAAEH;AAFD,GAAP;AAID,CALD;;AAOA,OAAO,SAASI,iBAAT,CAA2BC,GAA3B,EAA4D;AACjE,SAAQC,QAAD,IAA6B;AAClCX,IAAAA,KAAK,CAAC;AACJY,MAAAA,MAAM,EAAE,MADJ;AAEJC,MAAAA,GAAG,EAAEX,GAAG,CAACY,WAFL;AAGJN,MAAAA,IAAI,EAAEE,GAHF;AAIJK,MAAAA,OAAO,EAAE;AACP,+BAAuB,YAAYC,YAAY,CAACC,OAAb,CAAqB,OAArB;AAD5B;AAJL,KAAD,CAAL,CAOGC,IAPH,CAOQ,UAAUb,GAAV,EAAe;AAErB,UAAIc,GAAsB,GACxBrB,OAAO,CAACsB,QAAR,CAAiBC,UAAjB,CACEpB,aAAa,CAACI,GAAG,CAACG,IAAL,EAAqB;AAChCc,QAAAA,IAAI,EAAE;AAD0B,OAArB,CADf,CADF;;AAOA,UAAIjB,GAAG,CAACkB,MAAJ,KAAe,GAAf,IAAsBJ,GAAG,CAACK,OAA9B,EAAuC;AACrCrB,QAAAA,YAAY,CAAC,SAAD,CAAZ,CAAwB;AACtBsB,UAAAA,OAAO,EAAE,MADa;AAEtBC,UAAAA,WAAW,EAAE;AAFS,SAAxB;AAID,OALD,MAKO;AACLvB,QAAAA,YAAY,CAAC,SAAD,CAAZ,CAAwB;AACtBsB,UAAAA,OAAO,EAAE,MADa;AAEtBC,UAAAA,WAAW,EAAEP,GAAG,CAACM;AAFK,SAAxB;AAID;AACF,KA3BD,EA4BGE,KA5BH,CA4BS,UAAUC,GAAV,EAAe;AACpBZ,MAAAA,YAAY,CAACa,UAAb,CAAwB,OAAxB;AACAC,MAAAA,MAAM,CAACC,aAAP,CAAqBC,IAArB,CAA0B,QAA1B;AACD,KA/BH;AAgCD,GAjCD;AAkCD;AACD,OAAO,SAASC,kBAAT,GAA8B;AACnC,SAAQtB,QAAD,IAAqC;AAC1CX,IAAAA,KAAK,CAAC;AACJY,MAAAA,MAAM,EAAE,KADJ;AAEJC,MAAAA,GAAG,EAAEX,GAAG,CAACY,WAFL;AAGJC,MAAAA,OAAO,EAAE;AACP,+BAAuB,YAAYC,YAAY,CAACC,OAAb,CAAqB,OAArB;AAD5B;AAHL,KAAD,CAAL,CAMGC,IANH,CAMQ,UAAUb,GAAV,EAAe;AAErB,UAAIc,GAAiC,GACnCrB,OAAO,CAACoC,mBAAR,CAA4Bb,UAA5B,CACEpB,aAAa,CAACI,GAAG,CAACG,IAAL,EAAqB;AAChCc,QAAAA,IAAI,EAAE;AAD0B,OAArB,CADf,CADF;;AAOA,UAAIjB,GAAG,CAACkB,MAAJ,KAAe,GAAf,IAAsBJ,GAAG,CAACK,OAA9B,EAAuC;AACrCW,QAAAA,MAAM,CAAC9B,GAAG,CAACG,IAAL,CAAN;AACAG,QAAAA,QAAQ,CAACP,iBAAiB,CAACe,GAAG,CAACX,IAAL,CAAlB,CAAR;AACD,OAHD,MAGO;AACLL,QAAAA,YAAY,CAAC,SAAD,CAAZ,CAAwB;AACtBsB,UAAAA,OAAO,EAAE,MADa;AAEtBC,UAAAA,WAAW,EAAEP,GAAG,CAACM;AAFK,SAAxB;AAID;AACF,KAxBD,EAyBGE,KAzBH,CAyBS,UAAUC,GAAV,EAAe;AACpBZ,MAAAA,YAAY,CAACa,UAAb,CAAwB,OAAxB;AACAC,MAAAA,MAAM,CAACC,aAAP,CAAqBC,IAArB,CAA0B,QAA1B;AACD,KA5BH;AA6BD,GA9BD;AA+BD;;AAED,SAASG,MAAT,CAAgB3B,IAAhB,EAA2C;AAAE;AAC3C;AACAA,EAAAA,IAAI,CAAC4B,OAAL,CAAa,UAAUC,IAAV,EAAgB;AAC3BA,IAAAA,IAAI,CAACC,KAAL,GAAaD,IAAI,CAACE,QAAlB;AACAF,IAAAA,IAAI,CAACG,KAAL,GAAaH,IAAI,CAACI,EAAlB;AACAJ,IAAAA,IAAI,CAACK,GAAL,GAAWL,IAAI,CAACI,EAAhB,CAH2B,CAI3B;AACA;AACA;AACD,GAPD,EAFyC,CAWzC;;AACA,MAAIE,GAAG,GAAG,EAAV;AACAnC,EAAAA,IAAI,CAAC4B,OAAL,CAAa,UAAUC,IAAV,EAAgB;AAC3BM,IAAAA,GAAG,CAACN,IAAI,CAACG,KAAN,CAAH,GAAkBH,IAAlB;AACD,GAFD,EAbyC,CAgBzC;;AAEA,MAAIO,GAAG,GAAG,EAAV;AACApC,EAAAA,IAAI,CAAC4B,OAAL,CAAa,UAAUC,IAAV,EAAgB;AAC3B;AACA,QAAIQ,MAAM,GAAGF,GAAG,CAACN,IAAI,CAACS,GAAN,CAAhB,CAF2B,CAG3B;;AACA,QAAID,MAAJ,EAAY;AACV,OAACA,MAAM,CAACE,QAAP,KAAoBF,MAAM,CAACE,QAAP,GAAkB,EAAtC,CAAD,EAA4Cf,IAA5C,CAAiDK,IAAjD,EADU,CAC8C;AACxD;AACD,KAHD,MAGO;AACL;AACAO,MAAAA,GAAG,CAACZ,IAAJ,CAASK,IAAT;AACD;AACF,GAXD;AAcA,SAAOO,GAAP;AACD","sourcesContent":["import { manager } from '@/service/api/v1/manager_pb'\nimport * as types from '@/pages/content/pages/menu/store/types'\nimport axios from 'axios';\nimport camelcaseKeys from 'camelcase-keys'\nimport api from '@/requestAPI';\nimport { notification } from 'antd';\nimport { Dispatch } from \"redux\"\ndeclare global {\n  interface Window {\n    globalHistory: any\n  }\n}\nconst getMenuListAction = (res: manager.IMenuInfo[]): types.GetMenuListAction => {\n  return {\n    type: types.GET_MENU_LIST,\n    data: res\n  }\n}\n\nexport function createMenuRequest(req: manager.ICreateMenuRequest) {\n  return (dispatch: Dispatch<any>) => {\n    axios({\n      method: 'post',\n      url: api.managerMenu,\n      data: req,\n      headers: {\n        \"Grpc-metadata-token\": \"BEARER \" + localStorage.getItem(\"token\")\n      }\n    }).then(function (res) {\n\n      let ret: manager.IResponse =\n        manager.Response.fromObject(\n          camelcaseKeys(res.data as Object, {\n            deep: true\n          }),\n        )\n\n      if (res.status === 200 && ret.success) {\n        notification['success']({\n          message: '信息提示',\n          description: \"新增成功\"\n        });\n      } else {\n        notification['warning']({\n          message: '信息提示',\n          description: ret.message\n        });\n      }\n    })\n      .catch(function (err) {\n        localStorage.removeItem(\"token\")\n        window.globalHistory.push('/login')\n      });\n  }\n}\nexport function getMenuListRequest() {\n  return (dispatch: types.GetMenuDispatch) => {\n    axios({\n      method: 'get',\n      url: api.managerMenu,\n      headers: {\n        \"Grpc-metadata-token\": \"BEARER \" + localStorage.getItem(\"token\")\n      }\n    }).then(function (res) {\n\n      let ret: manager.IGetMenuListResponse =\n        manager.GetMenuListResponse.fromObject(\n          camelcaseKeys(res.data as Object, {\n            deep: true\n          }),\n        )\n\n      if (res.status === 200 && ret.success) {\n        toTree(res.data)\n        dispatch(getMenuListAction(ret.data as manager.IMenuInfo[]))\n      } else {\n        notification['warning']({\n          message: '信息提示',\n          description: ret.message\n        });\n      }\n    })\n      .catch(function (err) {\n        localStorage.removeItem(\"token\")\n        window.globalHistory.push('/login')\n      });\n  }\n}\n\nfunction toTree(data: manager.IMenuInfo[]) { //递归树算法 将pid-id的数据库返回的json 转为树json\n  // 删除 所有 children,以防止多次调用\n  data.forEach(function (item) {\n    item.title = item.menuName;\n    item.value = item.id;\n    item.key = item.id;\n    // delete item.id;\n    // delete item.name;\n    // delete item.children;\n  });\n\n  // 将数据存储为 以id为KEY的map索引数据列 \n  let map = {};\n  data.forEach(function (item) {\n    map[item.value] = item;\n  });\n  // console.log(map);\n\n  let val = [];\n  data.forEach(function (item) {\n    // 以当前遍历项，的pid,去map对象中找到索引的id\n    var parent = map[item.pid];\n    // 好绕啊，如果找到索引，那么说明此项不在顶级当中,那么需要把此项添加到，他对应的父级中\n    if (parent) {\n      (parent.children || (parent.children = [])).push(item); //这里更改的是map对象的数据(索引数据)\n      // console.log(map);\n    } else {\n      //如果没有在map中找到对应的索引ID,那么直接把 当前的item添加到 val结果集中，作为顶级\n      val.push(item);\n    }\n  });\n\n\n  return val\n}\n"]},"metadata":{},"sourceType":"module"}