{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { isString } from '@antv/util';\nimport { interaction, animation, theme, scale } from '../../adaptor/common';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { deepAssign, flow, pick, renderGaugeStatistic } from '../../utils';\nimport { RANGE_TYPE, RANGE_VALUE, PERCENT, DEFAULT_COLOR, INDICATEOR_VIEW_ID, RANGE_VIEW_ID, MASK_VIEW_ID } from './constant';\nimport { getIndicatorData, getRangeData } from './utils';\n/**\n * geometry 处理\n * @param params\n */\n\nfunction geometry(params) {\n  var chart = params.chart,\n      options = params.options;\n  var percent = options.percent,\n      range = options.range,\n      radius = options.radius,\n      innerRadius = options.innerRadius,\n      startAngle = options.startAngle,\n      endAngle = options.endAngle,\n      axis = options.axis,\n      indicator = options.indicator;\n  var color = range.color; // 指标 & 指针\n  // 如果开启在应用\n\n  if (indicator) {\n    var indicatorData = getIndicatorData(percent);\n    var v1 = chart.createView({\n      id: INDICATEOR_VIEW_ID\n    });\n    v1.data(indicatorData);\n    v1.point().position(PERCENT + \"*1\").shape('gauge-indicator') // 传入指针的样式到自定义 shape 中\n    .customInfo({\n      defaultColor: chart.getTheme().defaultColor,\n      indicator: indicator\n    });\n    v1.coordinate('polar', {\n      startAngle: startAngle,\n      endAngle: endAngle,\n      radius: innerRadius * radius\n    });\n    v1.axis(PERCENT, axis); // 一部分应用到 scale 中\n\n    v1.scale(PERCENT, pick(axis, AXIS_META_CONFIG_KEYS));\n  } // 辅助 range\n  // [{ range: 1, type: '0' }]\n\n\n  var rangeData = getRangeData(percent, options.range);\n  var v2 = chart.createView({\n    id: RANGE_VIEW_ID\n  });\n  v2.data(rangeData);\n  var rangeColor = isString(color) ? [color, DEFAULT_COLOR] : color;\n  v2.interval().position(\"1*\" + RANGE_VALUE).color(RANGE_TYPE, rangeColor).adjust('stack');\n  v2.coordinate('polar', {\n    innerRadius: innerRadius,\n    radius: radius,\n    startAngle: startAngle,\n    endAngle: endAngle\n  }).transpose();\n  return params;\n}\n/**\n * meter 类型的仪表盘 有一层 mask\n * @param params\n */\n\n\nfunction meterView(params) {\n  var _a;\n\n  var chart = params.chart,\n      options = params.options;\n  var type = options.type,\n      meter = options.meter;\n\n  if (type === 'meter') {\n    var innerRadius = options.innerRadius,\n        radius = options.radius,\n        startAngle = options.startAngle,\n        endAngle = options.endAngle;\n    var background = chart.getTheme().background;\n    var color = background;\n\n    if (!color || color === 'transparent') {\n      color = '#fff';\n    }\n\n    var v3 = chart.createView({\n      id: MASK_VIEW_ID\n    });\n    v3.data([(_a = {}, _a[RANGE_TYPE] = '1', _a[RANGE_VALUE] = 1, _a)]);\n    v3.interval().position(\"1*\" + RANGE_VALUE).color(color).adjust('stack').shape('meter-gauge').customInfo(meter || {});\n    v3.coordinate('polar', {\n      innerRadius: innerRadius,\n      radius: radius,\n      startAngle: startAngle,\n      endAngle: endAngle\n    }).transpose();\n  }\n\n  return params;\n}\n/**\n * meta 配置\n * @param params\n */\n\n\nfunction meta(params) {\n  var _a;\n\n  return flow(scale((_a = {\n    range: {\n      min: 0,\n      max: 1,\n      maxLimit: 1,\n      minLimit: 0\n    }\n  }, _a[PERCENT] = {}, _a)))(params);\n}\n/**\n * 统计指标文档\n * @param params\n */\n\n\nfunction statistic(params, updated) {\n  var chart = params.chart,\n      options = params.options;\n  var statistic = options.statistic,\n      percent = options.percent; // 先清空标注，再重新渲染\n\n  chart.getController('annotation').clear(true);\n\n  if (statistic) {\n    var content = statistic.content;\n    var transformContent = void 0; // 当设置 content 的时候，设置默认样式\n\n    if (content) {\n      transformContent = deepAssign({}, {\n        formatter: function (_a) {\n          var percent = _a.percent;\n          return (percent * 100).toFixed(2) + \"%\";\n        },\n        style: {\n          opacity: 0.75,\n          fontSize: '30px',\n          lineHeight: 1,\n          textAlign: 'center',\n          color: 'rgba(44,53,66,0.85)'\n        }\n      }, content);\n    }\n\n    renderGaugeStatistic(chart, {\n      statistic: __assign(__assign({}, statistic), {\n        content: transformContent\n      })\n    }, {\n      percent: percent\n    });\n  }\n\n  if (updated) {\n    chart.render(true);\n  }\n\n  return params;\n}\n/**\n * other 配置\n * @param params\n */\n\n\nfunction other(params) {\n  var chart = params.chart;\n  chart.legend(false);\n  chart.tooltip(false);\n  return params;\n}\n/**\n * 对外暴露的 adaptor\n */\n\n\nexport { statistic };\n/**\n * 图适配器\n * @param chart\n * @param options\n */\n\nexport function adaptor(params) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow( // animation 配置必须在 createView 之前，不然无法让子 View 生效\n  animation, geometry, meta, statistic, interaction, theme, // meterView 需要放到主题之后\n  meterView, other // ... 其他的 adaptor flow\n  )(params);\n}","map":{"version":3,"sources":["../../../src/plots/gauge/adaptor.ts"],"names":[],"mappings":"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","sourcesContent":["import { isString } from '@antv/util';\nimport { interaction, animation, theme, scale } from '../../adaptor/common';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { Params } from '../../core/adaptor';\nimport { Data } from '../../types';\nimport { deepAssign, flow, pick, renderGaugeStatistic } from '../../utils';\nimport {\n  RANGE_TYPE,\n  RANGE_VALUE,\n  PERCENT,\n  DEFAULT_COLOR,\n  INDICATEOR_VIEW_ID,\n  RANGE_VIEW_ID,\n  MASK_VIEW_ID,\n} from './constant';\nimport { GaugeOptions } from './types';\nimport { getIndicatorData, getRangeData } from './utils';\n\n/**\n * geometry 处理\n * @param params\n */\nfunction geometry(params: Params<GaugeOptions>): Params<GaugeOptions> {\n  const { chart, options } = params;\n  const { percent, range, radius, innerRadius, startAngle, endAngle, axis, indicator } = options;\n  const { color } = range;\n\n  // 指标 & 指针\n  // 如果开启在应用\n  if (indicator) {\n    const indicatorData = getIndicatorData(percent);\n\n    const v1 = chart.createView({ id: INDICATEOR_VIEW_ID });\n    v1.data(indicatorData);\n\n    v1.point()\n      .position(`${PERCENT}*1`)\n      .shape('gauge-indicator')\n      // 传入指针的样式到自定义 shape 中\n      .customInfo({\n        defaultColor: chart.getTheme().defaultColor,\n        indicator,\n      });\n\n    v1.coordinate('polar', {\n      startAngle,\n      endAngle,\n      radius: innerRadius * radius, // 外部的 innerRadius * radius = 这里的 radius\n    });\n\n    v1.axis(PERCENT, axis);\n    // 一部分应用到 scale 中\n    v1.scale(PERCENT, pick(axis, AXIS_META_CONFIG_KEYS));\n  }\n\n  // 辅助 range\n  // [{ range: 1, type: '0' }]\n  const rangeData: Data = getRangeData(percent, options.range);\n  const v2 = chart.createView({ id: RANGE_VIEW_ID });\n  v2.data(rangeData);\n\n  const rangeColor = isString(color) ? [color, DEFAULT_COLOR] : color;\n\n  v2.interval().position(`1*${RANGE_VALUE}`).color(RANGE_TYPE, rangeColor).adjust('stack');\n\n  v2.coordinate('polar', {\n    innerRadius,\n    radius,\n    startAngle,\n    endAngle,\n  }).transpose();\n\n  return params;\n}\n\n/**\n * meter 类型的仪表盘 有一层 mask\n * @param params\n */\nfunction meterView(params: Params<GaugeOptions>): Params<GaugeOptions> {\n  const { chart, options } = params;\n\n  const { type, meter } = options;\n  if (type === 'meter') {\n    const { innerRadius, radius, startAngle, endAngle } = options;\n\n    const { background } = chart.getTheme();\n\n    let color = background;\n    if (!color || color === 'transparent') {\n      color = '#fff';\n    }\n\n    const v3 = chart.createView({ id: MASK_VIEW_ID });\n    v3.data([{ [RANGE_TYPE]: '1', [RANGE_VALUE]: 1 }]);\n    v3.interval()\n      .position(`1*${RANGE_VALUE}`)\n      .color(color)\n      .adjust('stack')\n      .shape('meter-gauge')\n      .customInfo(meter || {});\n    v3.coordinate('polar', { innerRadius, radius, startAngle, endAngle }).transpose();\n  }\n\n  return params;\n}\n\n/**\n * meta 配置\n * @param params\n */\nfunction meta(params: Params<GaugeOptions>): Params<GaugeOptions> {\n  return flow(\n    scale({\n      range: {\n        min: 0,\n        max: 1,\n        maxLimit: 1,\n        minLimit: 0,\n      },\n      [PERCENT]: {},\n    })\n  )(params);\n}\n\n/**\n * 统计指标文档\n * @param params\n */\nfunction statistic(params: Params<GaugeOptions>, updated?: boolean): Params<GaugeOptions> {\n  const { chart, options } = params;\n  const { statistic, percent } = options;\n\n  // 先清空标注，再重新渲染\n  chart.getController('annotation').clear(true);\n  if (statistic) {\n    const { content } = statistic;\n    let transformContent;\n    // 当设置 content 的时候，设置默认样式\n    if (content) {\n      transformContent = deepAssign(\n        {},\n        {\n          formatter: ({ percent }) => `${(percent * 100).toFixed(2)}%`,\n          style: {\n            opacity: 0.75,\n            fontSize: '30px',\n            lineHeight: 1,\n            textAlign: 'center',\n            color: 'rgba(44,53,66,0.85)',\n          },\n        },\n        content\n      );\n    }\n    renderGaugeStatistic(chart, { statistic: { ...statistic, content: transformContent } }, { percent });\n  }\n\n  if (updated) {\n    chart.render(true);\n  }\n\n  return params;\n}\n\n/**\n * other 配置\n * @param params\n */\nfunction other(params: Params<GaugeOptions>): Params<GaugeOptions> {\n  const { chart } = params;\n\n  chart.legend(false);\n  chart.tooltip(false);\n\n  return params;\n}\n\n/**\n * 对外暴露的 adaptor\n */\nexport { statistic };\n\n/**\n * 图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<GaugeOptions>) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(\n    // animation 配置必须在 createView 之前，不然无法让子 View 生效\n    animation,\n    geometry,\n    meta,\n    statistic,\n    interaction,\n    theme,\n    // meterView 需要放到主题之后\n    meterView,\n    other\n    // ... 其他的 adaptor flow\n  )(params);\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}