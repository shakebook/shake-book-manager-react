{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n/**\n * 基于 G 的时间轴组件\n */\n\n\nimport { Canvas as GCanvas } from '@antv/g-canvas';\nimport { Canvas as GSVGCanvas } from '@antv/g-svg';\nimport { createDom, modifyCSS } from '@antv/dom-util';\nimport Base from '../base';\nimport TrendTimeBar from './trendTimeBar';\nimport TimeBarSlice from './timeBarSlice';\nimport { VALUE_CHANGE } from './constant';\nimport { isString } from '@antv/util'; // simple 版本默认高度\n\nvar DEFAULT_SIMPLE_HEIGHT = 8; // trend 版本默认高度\n\nvar DEFAULT_TREND_HEIGHT = 26;\n\nvar TimeBar =\n/** @class */\nfunction (_super) {\n  __extends(TimeBar, _super);\n\n  function TimeBar() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  TimeBar.prototype.getDefaultCfgs = function () {\n    return {\n      container: null,\n      className: 'g6-component-timebar',\n      padding: 10,\n      type: 'trend',\n      trend: {\n        data: [],\n        isArea: false,\n        smooth: true\n      },\n      controllerCfg: {\n        speed: 2,\n        loop: false\n      },\n      slider: {\n        start: 0.1,\n        end: 0.9,\n        minText: 'min',\n        maxText: 'max'\n      },\n      tick: {\n        start: 0.1,\n        end: 0.9,\n        data: []\n      },\n      textStyle: {}\n    };\n  };\n  /**\n   * 初始化 TimeBar 的容器\n   */\n\n\n  TimeBar.prototype.initContainer = function () {\n    var graph = this.get('graph');\n    var _a = this._cfgs,\n        width = _a.width,\n        height = _a.height;\n    var className = this.get('className') || 'g6-component-timebar';\n    var container = this.get('container');\n    var graphContainer = this.get('graph').get('container');\n    var timeBarContainer;\n\n    if (!container) {\n      timeBarContainer = createDom(\"<div class='\" + className + \"'></div>\");\n      modifyCSS(timeBarContainer, {\n        position: 'relative'\n      });\n    } else {\n      if (isString(container)) {\n        container = document.getElementById(container);\n      }\n\n      timeBarContainer = container;\n    }\n\n    graphContainer.appendChild(timeBarContainer);\n    this.set('timeBarContainer', timeBarContainer);\n    var canvas;\n    var renderer = graph.get('renderer');\n\n    if (renderer === 'SVG') {\n      canvas = new GSVGCanvas({\n        container: timeBarContainer,\n        width: width,\n        height: height\n      });\n    } else {\n      canvas = new GCanvas({\n        container: timeBarContainer,\n        width: width,\n        height: height\n      });\n    }\n\n    this.set('canvas', canvas);\n  };\n\n  TimeBar.prototype.init = function () {\n    this.initContainer();\n    var canvas = this.get('canvas');\n    var timeBarGroup = canvas.addGroup({\n      name: 'timebar-group'\n    });\n    this.set('timeBarGroup', timeBarGroup);\n    this.renderTrend();\n    this.initEvent();\n    var fontFamily = typeof window !== 'undefined' ? window.getComputedStyle(document.body, null).getPropertyValue('font-family') || 'Arial, sans-serif' : 'Arial, sans-serif';\n    this.set('fontFamily', fontFamily);\n  };\n\n  TimeBar.prototype.renderTrend = function () {\n    var _a = this._cfgs,\n        width = _a.width,\n        x = _a.x,\n        y = _a.y,\n        padding = _a.padding,\n        type = _a.type,\n        trend = _a.trend,\n        slider = _a.slider,\n        controllerCfg = _a.controllerCfg,\n        textStyle = _a.textStyle;\n\n    var data = trend.data,\n        other = __rest(trend, [\"data\"]);\n\n    var realWidth = width - 2 * padding;\n    var defaultHeight = type === 'trend' ? DEFAULT_TREND_HEIGHT : DEFAULT_SIMPLE_HEIGHT;\n    var graph = this.get('graph');\n    var group = this.get('timeBarGroup');\n    var canvas = this.get('canvas');\n    var timebar = null;\n\n    if (type === 'trend' || type === 'simple') {\n      timebar = new TrendTimeBar(__assign(__assign({\n        graph: graph,\n        canvas: canvas,\n        group: group,\n        type: type,\n        x: x + padding,\n        y: type === 'trend' ? y + padding : y + padding + 15,\n        width: realWidth,\n        height: defaultHeight,\n        padding: padding,\n        trendCfg: __assign(__assign({}, other), {\n          data: data.map(function (d) {\n            return d.value;\n          })\n        })\n      }, slider), {\n        ticks: data.map(function (d) {\n          return d.date;\n        }),\n        handlerStyle: __assign(__assign({}, slider.handlerStyle), {\n          height: slider.height || defaultHeight\n        }),\n        controllerCfg: controllerCfg,\n        textStyle: textStyle\n      }));\n    } else if (type === 'tick') {\n      var tick = this._cfgs.tick; // 刻度时间轴\n\n      timebar = new TimeBarSlice(__assign({\n        graph: graph,\n        canvas: canvas,\n        group: group,\n        x: x + padding,\n        y: y + padding\n      }, tick));\n    }\n\n    this.set('timebar', timebar);\n  };\n\n  TimeBar.prototype.filterData = function (evt) {\n    var value = evt.value;\n    var trendData = null;\n    var type = this._cfgs.type;\n\n    if (type === 'trend' || type === 'simple') {\n      trendData = this._cfgs.trend.data;\n    } else if (type === 'tick') {\n      trendData = this._cfgs.tick.data;\n    }\n\n    if (!trendData || trendData.length === 0) {\n      console.warn('请配置 TimeBar 组件的数据');\n      return;\n    }\n\n    var rangeChange = this.get('rangeChange');\n    var graph = this.get('graph');\n    var min = Math.round(trendData.length * value[0]);\n    var max = Math.round(trendData.length * value[1]);\n    max = max >= trendData.length ? trendData.length - 1 : max;\n    var minText = trendData[min].date;\n    var maxText = trendData[max].date;\n\n    if (type !== 'tick') {\n      var timebar = this.get('timebar');\n      timebar.setText(minText, maxText);\n    }\n\n    if (rangeChange) {\n      rangeChange(graph, minText, maxText);\n    } else {\n      // 自动过滤数据，并渲染 graph\n      var graphData = graph.save();\n\n      if (!this.cacheGraphData || this.cacheGraphData.nodes && this.cacheGraphData.nodes.length === 0) {\n        this.cacheGraphData = graphData;\n      } // 过滤不在 min 和 max 范围内的节点\n\n\n      var filterData = this.cacheGraphData.nodes.filter(function (d) {\n        return d.date >= minText && d.date <= maxText;\n      });\n      var nodeIds_1 = filterData.map(function (node) {\n        return node.id;\n      }); // 过滤 source 或 target 不在 min 和 max 范围内的边\n\n      var fileterEdges = this.cacheGraphData.edges.filter(function (edge) {\n        return nodeIds_1.includes(edge.source) && nodeIds_1.includes(edge.target);\n      });\n      graph.changeData({\n        nodes: filterData,\n        edges: fileterEdges\n      });\n    }\n  };\n\n  TimeBar.prototype.initEvent = function () {\n    var _this = this;\n\n    var start = 0;\n    var end = 0;\n    var type = this._cfgs.type;\n\n    if (!type || type === 'trend' || type === 'simple') {\n      start = this._cfgs.slider.start;\n      end = this._cfgs.slider.end;\n    } else if (type === 'tick') {\n      start = this._cfgs.tick.start;\n      end = this._cfgs.tick.end;\n    }\n\n    var graph = this.get('graph');\n    graph.on('afterrender', function () {\n      _this.filterData({\n        value: [start, end]\n      });\n    }); // 时间轴的值发生改变的事件\n\n    graph.on(VALUE_CHANGE, function (e) {\n      // 范围变化\n      _this.filterData(e);\n    });\n  };\n\n  TimeBar.prototype.destroy = function () {\n    var timebar = this.get('timebar');\n\n    if (timebar && timebar.destory) {\n      timebar.destory();\n    }\n\n    _super.prototype.destroy.call(this);\n\n    var timeBarContainer = this.get('timeBarContainer');\n\n    if (timeBarContainer) {\n      var container = this.get('container');\n\n      if (!container) {\n        container = this.get('graph').get('container');\n      }\n\n      if (isString(container)) {\n        container = document.getElementById(container);\n      }\n\n      container.removeChild(timeBarContainer);\n    }\n  };\n\n  return TimeBar;\n}(Base);\n\nexport default TimeBar;","map":{"version":3,"sources":["/Users/yangjiafeng/web-src/shake-book-manager/node_modules/@antv/g6-plugin/es/timeBar/index.js"],"names":["__extends","_extendStatics","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","Canvas","GCanvas","GSVGCanvas","createDom","modifyCSS","Base","TrendTimeBar","TimeBarSlice","VALUE_CHANGE","isString","DEFAULT_SIMPLE_HEIGHT","DEFAULT_TREND_HEIGHT","TimeBar","_super","getDefaultCfgs","container","className","padding","type","trend","data","isArea","smooth","controllerCfg","speed","loop","slider","start","end","minText","maxText","tick","textStyle","initContainer","graph","get","_a","_cfgs","width","height","graphContainer","timeBarContainer","position","document","getElementById","appendChild","set","canvas","renderer","init","timeBarGroup","addGroup","name","renderTrend","initEvent","fontFamily","window","getComputedStyle","body","getPropertyValue","x","y","other","realWidth","defaultHeight","group","timebar","trendCfg","map","value","ticks","date","handlerStyle","filterData","evt","trendData","console","warn","rangeChange","min","Math","round","max","setText","graphData","save","cacheGraphData","nodes","filter","nodeIds_1","node","id","fileterEdges","edges","edge","includes","source","target","changeData","_this","on","destroy","destory","removeChild"],"mappings":"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","sourcesContent":["var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n/**\n * 基于 G 的时间轴组件\n */\n\n\nimport { Canvas as GCanvas } from '@antv/g-canvas';\nimport { Canvas as GSVGCanvas } from '@antv/g-svg';\nimport { createDom, modifyCSS } from '@antv/dom-util';\nimport Base from '../base';\nimport TrendTimeBar from './trendTimeBar';\nimport TimeBarSlice from './timeBarSlice';\nimport { VALUE_CHANGE } from './constant';\nimport { isString } from '@antv/util'; // simple 版本默认高度\n\nvar DEFAULT_SIMPLE_HEIGHT = 8; // trend 版本默认高度\n\nvar DEFAULT_TREND_HEIGHT = 26;\n\nvar TimeBar =\n/** @class */\nfunction (_super) {\n  __extends(TimeBar, _super);\n\n  function TimeBar() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  TimeBar.prototype.getDefaultCfgs = function () {\n    return {\n      container: null,\n      className: 'g6-component-timebar',\n      padding: 10,\n      type: 'trend',\n      trend: {\n        data: [],\n        isArea: false,\n        smooth: true\n      },\n      controllerCfg: {\n        speed: 2,\n        loop: false\n      },\n      slider: {\n        start: 0.1,\n        end: 0.9,\n        minText: 'min',\n        maxText: 'max'\n      },\n      tick: {\n        start: 0.1,\n        end: 0.9,\n        data: []\n      },\n      textStyle: {}\n    };\n  };\n  /**\n   * 初始化 TimeBar 的容器\n   */\n\n\n  TimeBar.prototype.initContainer = function () {\n    var graph = this.get('graph');\n    var _a = this._cfgs,\n        width = _a.width,\n        height = _a.height;\n    var className = this.get('className') || 'g6-component-timebar';\n    var container = this.get('container');\n    var graphContainer = this.get('graph').get('container');\n    var timeBarContainer;\n\n    if (!container) {\n      timeBarContainer = createDom(\"<div class='\" + className + \"'></div>\");\n      modifyCSS(timeBarContainer, {\n        position: 'relative'\n      });\n    } else {\n      if (isString(container)) {\n        container = document.getElementById(container);\n      }\n\n      timeBarContainer = container;\n    }\n\n    graphContainer.appendChild(timeBarContainer);\n    this.set('timeBarContainer', timeBarContainer);\n    var canvas;\n    var renderer = graph.get('renderer');\n\n    if (renderer === 'SVG') {\n      canvas = new GSVGCanvas({\n        container: timeBarContainer,\n        width: width,\n        height: height\n      });\n    } else {\n      canvas = new GCanvas({\n        container: timeBarContainer,\n        width: width,\n        height: height\n      });\n    }\n\n    this.set('canvas', canvas);\n  };\n\n  TimeBar.prototype.init = function () {\n    this.initContainer();\n    var canvas = this.get('canvas');\n    var timeBarGroup = canvas.addGroup({\n      name: 'timebar-group'\n    });\n    this.set('timeBarGroup', timeBarGroup);\n    this.renderTrend();\n    this.initEvent();\n    var fontFamily = typeof window !== 'undefined' ? window.getComputedStyle(document.body, null).getPropertyValue('font-family') || 'Arial, sans-serif' : 'Arial, sans-serif';\n    this.set('fontFamily', fontFamily);\n  };\n\n  TimeBar.prototype.renderTrend = function () {\n    var _a = this._cfgs,\n        width = _a.width,\n        x = _a.x,\n        y = _a.y,\n        padding = _a.padding,\n        type = _a.type,\n        trend = _a.trend,\n        slider = _a.slider,\n        controllerCfg = _a.controllerCfg,\n        textStyle = _a.textStyle;\n\n    var data = trend.data,\n        other = __rest(trend, [\"data\"]);\n\n    var realWidth = width - 2 * padding;\n    var defaultHeight = type === 'trend' ? DEFAULT_TREND_HEIGHT : DEFAULT_SIMPLE_HEIGHT;\n    var graph = this.get('graph');\n    var group = this.get('timeBarGroup');\n    var canvas = this.get('canvas');\n    var timebar = null;\n\n    if (type === 'trend' || type === 'simple') {\n      timebar = new TrendTimeBar(__assign(__assign({\n        graph: graph,\n        canvas: canvas,\n        group: group,\n        type: type,\n        x: x + padding,\n        y: type === 'trend' ? y + padding : y + padding + 15,\n        width: realWidth,\n        height: defaultHeight,\n        padding: padding,\n        trendCfg: __assign(__assign({}, other), {\n          data: data.map(function (d) {\n            return d.value;\n          })\n        })\n      }, slider), {\n        ticks: data.map(function (d) {\n          return d.date;\n        }),\n        handlerStyle: __assign(__assign({}, slider.handlerStyle), {\n          height: slider.height || defaultHeight\n        }),\n        controllerCfg: controllerCfg,\n        textStyle: textStyle\n      }));\n    } else if (type === 'tick') {\n      var tick = this._cfgs.tick; // 刻度时间轴\n\n      timebar = new TimeBarSlice(__assign({\n        graph: graph,\n        canvas: canvas,\n        group: group,\n        x: x + padding,\n        y: y + padding\n      }, tick));\n    }\n\n    this.set('timebar', timebar);\n  };\n\n  TimeBar.prototype.filterData = function (evt) {\n    var value = evt.value;\n    var trendData = null;\n    var type = this._cfgs.type;\n\n    if (type === 'trend' || type === 'simple') {\n      trendData = this._cfgs.trend.data;\n    } else if (type === 'tick') {\n      trendData = this._cfgs.tick.data;\n    }\n\n    if (!trendData || trendData.length === 0) {\n      console.warn('请配置 TimeBar 组件的数据');\n      return;\n    }\n\n    var rangeChange = this.get('rangeChange');\n    var graph = this.get('graph');\n    var min = Math.round(trendData.length * value[0]);\n    var max = Math.round(trendData.length * value[1]);\n    max = max >= trendData.length ? trendData.length - 1 : max;\n    var minText = trendData[min].date;\n    var maxText = trendData[max].date;\n\n    if (type !== 'tick') {\n      var timebar = this.get('timebar');\n      timebar.setText(minText, maxText);\n    }\n\n    if (rangeChange) {\n      rangeChange(graph, minText, maxText);\n    } else {\n      // 自动过滤数据，并渲染 graph\n      var graphData = graph.save();\n\n      if (!this.cacheGraphData || this.cacheGraphData.nodes && this.cacheGraphData.nodes.length === 0) {\n        this.cacheGraphData = graphData;\n      } // 过滤不在 min 和 max 范围内的节点\n\n\n      var filterData = this.cacheGraphData.nodes.filter(function (d) {\n        return d.date >= minText && d.date <= maxText;\n      });\n      var nodeIds_1 = filterData.map(function (node) {\n        return node.id;\n      }); // 过滤 source 或 target 不在 min 和 max 范围内的边\n\n      var fileterEdges = this.cacheGraphData.edges.filter(function (edge) {\n        return nodeIds_1.includes(edge.source) && nodeIds_1.includes(edge.target);\n      });\n      graph.changeData({\n        nodes: filterData,\n        edges: fileterEdges\n      });\n    }\n  };\n\n  TimeBar.prototype.initEvent = function () {\n    var _this = this;\n\n    var start = 0;\n    var end = 0;\n    var type = this._cfgs.type;\n\n    if (!type || type === 'trend' || type === 'simple') {\n      start = this._cfgs.slider.start;\n      end = this._cfgs.slider.end;\n    } else if (type === 'tick') {\n      start = this._cfgs.tick.start;\n      end = this._cfgs.tick.end;\n    }\n\n    var graph = this.get('graph');\n    graph.on('afterrender', function () {\n      _this.filterData({\n        value: [start, end]\n      });\n    }); // 时间轴的值发生改变的事件\n\n    graph.on(VALUE_CHANGE, function (e) {\n      // 范围变化\n      _this.filterData(e);\n    });\n  };\n\n  TimeBar.prototype.destroy = function () {\n    var timebar = this.get('timebar');\n\n    if (timebar && timebar.destory) {\n      timebar.destory();\n    }\n\n    _super.prototype.destroy.call(this);\n\n    var timeBarContainer = this.get('timeBarContainer');\n\n    if (timeBarContainer) {\n      var container = this.get('container');\n\n      if (!container) {\n        container = this.get('graph').get('container');\n      }\n\n      if (isString(container)) {\n        container = document.getElementById(container);\n      }\n\n      container.removeChild(timeBarContainer);\n    }\n  };\n\n  return TimeBar;\n}(Base);\n\nexport default TimeBar;"]},"metadata":{},"sourceType":"module"}