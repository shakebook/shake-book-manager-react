{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { useRef, useEffect } from 'react';\nimport { isEqual } from '@antv/util';\nimport { utils } from '../util';\nimport createNode from '../util/createNode';\nexport default function useInit(ChartClass, config) {\n  var chart = useRef();\n  var chartOptions = useRef();\n  var container = useRef(null);\n  var onReady = config.onReady,\n      onEvent = config.onEvent;\n  /**\n   * Get data base64\n   * @param {string} type A DOMString indicating the image format. The default format type is image/png.\n   * @param {number} encoderOptions A Number between 0 and 1 indicating the image quality\n   */\n\n  var toDataURL = function (type, encoderOptions) {\n    var _a;\n\n    if (type === void 0) {\n      type = 'image/png';\n    }\n\n    return (_a = chart.current) === null || _a === void 0 ? void 0 : _a.chart.canvas.cfg.el.toDataURL(type, encoderOptions);\n  };\n  /**\n   * Download Iamge\n   * @param {string} name A name of image\n   * @param {string} type A DOMString indicating the image format. The default format type is image/png.\n   * @param {number} encoderOptions A Number between 0 and 1 indicating the image quality\n   */\n\n\n  var downloadImage = function (name, type, encoderOptions) {\n    var _a;\n\n    if (name === void 0) {\n      name = 'download';\n    }\n\n    if (type === void 0) {\n      type = 'image/png';\n    }\n\n    var imageName = name;\n\n    if (name.indexOf('.') === -1) {\n      imageName = name + \".\" + type.split('/')[1];\n    }\n\n    var base64 = (_a = chart.current) === null || _a === void 0 ? void 0 : _a.chart.canvas.cfg.el.toDataURL(type, encoderOptions);\n    var a = document.createElement('a');\n    a.href = base64;\n    a.download = imageName;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    a = null;\n    return imageName;\n  };\n\n  var reactDomToString = function (source, path, type) {\n    var hasPath = utils.hasPath,\n        setPath = utils.setPath;\n    var statisticCustomHtml = hasPath(source, path);\n    setPath(source, path, function () {\n      var arg = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        arg[_i] = arguments[_i];\n      }\n\n      var statisticDom = utils.isType(statisticCustomHtml, 'Function') ? statisticCustomHtml.apply(void 0, arg) : statisticCustomHtml;\n\n      if (utils.isType(statisticDom, 'String') || utils.isType(statisticDom, 'Number') || utils.isType(statisticDom, 'HTMLDivElement')) {\n        return statisticDom;\n      }\n\n      return createNode(statisticDom, type);\n    });\n  };\n\n  var processConfig = function () {\n    var hasPath = utils.hasPath; // statistic\n\n    if (hasPath(config, ['statistic', 'content', 'customHtml'])) {\n      reactDomToString(config, ['statistic', 'content', 'customHtml']);\n    }\n\n    if (hasPath(config, ['statistic', 'title', 'customHtml'])) {\n      reactDomToString(config, ['statistic', 'title', 'customHtml']);\n    } // tooltip\n\n\n    if (typeof config.tooltip === 'object') {\n      if (hasPath(config, ['tooltip', 'container'])) {\n        reactDomToString(config, ['tooltip', 'container'], 'tooltip');\n      }\n\n      if (hasPath(config, ['tooltip', 'customContent'])) {\n        reactDomToString(config, ['tooltip', 'customContent'], 'tooltip');\n      }\n    }\n  };\n\n  useEffect(function () {\n    if (chart.current && !isEqual(chartOptions.current, config)) {\n      var changeData = false;\n\n      if (chartOptions.current) {\n        // 从 options 里面取出 data 、value 、 percent 进行比对，判断是否仅数值发生改变\n        var _a = chartOptions.current,\n            currentData = _a.data,\n            currentValue = _a.value,\n            currentPercent = _a.percent,\n            currentConfig = __rest(_a, [\"data\", \"value\", \"percent\"]);\n\n        var inputData = config.data,\n            inputValue = config.value,\n            inputPercent = config.percent,\n            inputConfig = __rest(config, [\"data\", \"value\", \"percent\"]);\n\n        changeData = isEqual(currentConfig, inputConfig);\n      }\n\n      if (changeData) {\n        var changeType_1 = 'data';\n        var typeMaps = ['percent']; // 特殊类型的图表 data 字段，例如 RingProgress\n\n        var currentKeys_1 = Object.keys(config);\n        typeMaps.forEach(function (type) {\n          if (currentKeys_1.includes(type)) {\n            changeType_1 = type;\n          }\n        });\n        chart.current.changeData((config === null || config === void 0 ? void 0 : config[changeType_1]) || []);\n      } else {\n        processConfig();\n        chart.current.update(config);\n      }\n\n      chartOptions.current = config;\n    }\n  }, [config]);\n  useEffect(function () {\n    if (!container.current) {\n      return function () {\n        return null;\n      };\n    }\n\n    processConfig();\n    var chartInstance = new ChartClass(container.current, __assign({}, config));\n\n    chartInstance.__proto__.toDataURL = function (type, encoderOptions) {\n      return toDataURL(type, encoderOptions);\n    };\n\n    chartInstance.__proto__.downloadImage = function (name, type, encoderOptions) {\n      return downloadImage(name, type, encoderOptions);\n    };\n\n    chartInstance.render();\n\n    if (!chartOptions.current) {\n      chartOptions.current = config;\n    }\n\n    chart.current = utils.clone(chartInstance);\n\n    if (onReady) {\n      onReady(chartInstance);\n    }\n\n    var handler = function (event) {\n      if (onEvent) {\n        onEvent(chartInstance, event);\n      }\n    };\n\n    chartInstance.on('*', handler); // 组件销毁时销毁图表\n\n    return function () {\n      if (chart.current) {\n        chart.current.destroy();\n        chart.current.off('*', handler);\n        chart.current = undefined;\n      }\n    };\n  }, []);\n  return {\n    chart: chart,\n    container: container\n  };\n}","map":{"version":3,"sources":["/Users/yangjiafeng/web-src/shake-book-manager/node_modules/@ant-design/charts/es/hooks/useChart.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","useRef","useEffect","isEqual","utils","createNode","useInit","ChartClass","config","chart","chartOptions","container","onReady","onEvent","toDataURL","type","encoderOptions","_a","current","canvas","cfg","el","downloadImage","name","imageName","split","base64","a","document","createElement","href","download","body","appendChild","click","removeChild","reactDomToString","source","path","hasPath","setPath","statisticCustomHtml","arg","_i","statisticDom","isType","processConfig","tooltip","changeData","currentData","data","currentValue","value","currentPercent","percent","currentConfig","inputData","inputValue","inputPercent","inputConfig","changeType_1","typeMaps","currentKeys_1","keys","forEach","includes","update","chartInstance","__proto__","render","clone","handler","event","on","destroy","off","undefined"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { useRef, useEffect } from 'react';\nimport { isEqual } from '@antv/util';\nimport { utils } from '../util';\nimport createNode from '../util/createNode';\nexport default function useInit(ChartClass, config) {\n    var chart = useRef();\n    var chartOptions = useRef();\n    var container = useRef(null);\n    var onReady = config.onReady, onEvent = config.onEvent;\n    /**\n     * Get data base64\n     * @param {string} type A DOMString indicating the image format. The default format type is image/png.\n     * @param {number} encoderOptions A Number between 0 and 1 indicating the image quality\n     */\n    var toDataURL = function (type, encoderOptions) {\n        var _a;\n        if (type === void 0) { type = 'image/png'; }\n        return (_a = chart.current) === null || _a === void 0 ? void 0 : _a.chart.canvas.cfg.el.toDataURL(type, encoderOptions);\n    };\n    /**\n     * Download Iamge\n     * @param {string} name A name of image\n     * @param {string} type A DOMString indicating the image format. The default format type is image/png.\n     * @param {number} encoderOptions A Number between 0 and 1 indicating the image quality\n     */\n    var downloadImage = function (name, type, encoderOptions) {\n        var _a;\n        if (name === void 0) { name = 'download'; }\n        if (type === void 0) { type = 'image/png'; }\n        var imageName = name;\n        if (name.indexOf('.') === -1) {\n            imageName = name + \".\" + type.split('/')[1];\n        }\n        var base64 = (_a = chart.current) === null || _a === void 0 ? void 0 : _a.chart.canvas.cfg.el.toDataURL(type, encoderOptions);\n        var a = document.createElement('a');\n        a.href = base64;\n        a.download = imageName;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        a = null;\n        return imageName;\n    };\n    var reactDomToString = function (source, path, type) {\n        var hasPath = utils.hasPath, setPath = utils.setPath;\n        var statisticCustomHtml = hasPath(source, path);\n        setPath(source, path, function () {\n            var arg = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                arg[_i] = arguments[_i];\n            }\n            var statisticDom = utils.isType(statisticCustomHtml, 'Function')\n                ? statisticCustomHtml.apply(void 0, arg) : statisticCustomHtml;\n            if (utils.isType(statisticDom, 'String') ||\n                utils.isType(statisticDom, 'Number') ||\n                utils.isType(statisticDom, 'HTMLDivElement')) {\n                return statisticDom;\n            }\n            return createNode(statisticDom, type);\n        });\n    };\n    var processConfig = function () {\n        var hasPath = utils.hasPath;\n        // statistic\n        if (hasPath(config, ['statistic', 'content', 'customHtml'])) {\n            reactDomToString(config, ['statistic', 'content', 'customHtml']);\n        }\n        if (hasPath(config, ['statistic', 'title', 'customHtml'])) {\n            reactDomToString(config, ['statistic', 'title', 'customHtml']);\n        }\n        // tooltip\n        if (typeof config.tooltip === 'object') {\n            if (hasPath(config, ['tooltip', 'container'])) {\n                reactDomToString(config, ['tooltip', 'container'], 'tooltip');\n            }\n            if (hasPath(config, ['tooltip', 'customContent'])) {\n                reactDomToString(config, ['tooltip', 'customContent'], 'tooltip');\n            }\n        }\n    };\n    useEffect(function () {\n        if (chart.current && !isEqual(chartOptions.current, config)) {\n            var changeData = false;\n            if (chartOptions.current) {\n                // 从 options 里面取出 data 、value 、 percent 进行比对，判断是否仅数值发生改变\n                var _a = chartOptions.current, currentData = _a.data, currentValue = _a.value, currentPercent = _a.percent, currentConfig = __rest(_a, [\"data\", \"value\", \"percent\"]);\n                var inputData = config.data, inputValue = config.value, inputPercent = config.percent, inputConfig = __rest(config, [\"data\", \"value\", \"percent\"]);\n                changeData = isEqual(currentConfig, inputConfig);\n            }\n            if (changeData) {\n                var changeType_1 = 'data';\n                var typeMaps = ['percent']; // 特殊类型的图表 data 字段，例如 RingProgress\n                var currentKeys_1 = Object.keys(config);\n                typeMaps.forEach(function (type) {\n                    if (currentKeys_1.includes(type)) {\n                        changeType_1 = type;\n                    }\n                });\n                chart.current.changeData((config === null || config === void 0 ? void 0 : config[changeType_1]) || []);\n            }\n            else {\n                processConfig();\n                chart.current.update(config);\n            }\n            chartOptions.current = config;\n        }\n    }, [config]);\n    useEffect(function () {\n        if (!container.current) {\n            return function () { return null; };\n        }\n        processConfig();\n        var chartInstance = new ChartClass(container.current, __assign({}, config));\n        chartInstance.__proto__.toDataURL = function (type, encoderOptions) {\n            return toDataURL(type, encoderOptions);\n        };\n        chartInstance.__proto__.downloadImage = function (name, type, encoderOptions) {\n            return downloadImage(name, type, encoderOptions);\n        };\n        chartInstance.render();\n        if (!chartOptions.current) {\n            chartOptions.current = config;\n        }\n        chart.current = utils.clone(chartInstance);\n        if (onReady) {\n            onReady(chartInstance);\n        }\n        var handler = function (event) {\n            if (onEvent) {\n                onEvent(chartInstance, event);\n            }\n        };\n        chartInstance.on('*', handler);\n        // 组件销毁时销毁图表\n        return function () {\n            if (chart.current) {\n                chart.current.destroy();\n                chart.current.off('*', handler);\n                chart.current = undefined;\n            }\n        };\n    }, []);\n    return {\n        chart: chart,\n        container: container,\n    };\n}\n"]},"metadata":{},"sourceType":"module"}